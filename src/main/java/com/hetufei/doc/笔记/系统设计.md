### restful的设计理念、修改和删除资源的时候为什么要把id放在url里而不放在http的参数里?

### 
分布式系统的就准备CAP理论、BASE理论、限流、熔断、一致性***算法、主从架构、集群架构、异地多活、负载均衡、分层架构、微服务等

### 如何设计一个分步式登录系统？

面试题
https://zhuanlan.zhihu.com/p/64736570


2PC缺陷：
2.1 同步阻塞 所有事务参与者在等待其它参与者响应的时候都处于同步阻塞状态，无法进行其它操作。

2.2 单点问题 协调者在 2PC 中起到非常大的作用，发生故障将会造成很大影响。特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作。

2.3 数据不一致 在阶段二，如果协调者只发送了部分 Commit 消息，此时网络发生异常，那么只有部分参与者接收到 Commit 消息，也就是说只有部分参与者提交了事务，使得系统数据不一致。

2.4 太过保守 任意一个节点失败就会导致整个事务失败，没有完善的容错机制。


3PC




TCC


本地消息表


最大努力通知
其实我觉得本地消息表也可以算最大努力，事务消息也可以算最大努力。

就本地消息表来说会有后台任务定时去查看未完成的消息，然后去调用对应的服务，当一个消息多次调用都失败的时候可以记录下然后引入人工，或者直接舍弃。这其实算是最大努力了。

事务消息也是一样，当半消息被commit了之后确实就是普通消息了，如果订阅者一直不消费或者消费不了则会一直重试，到最后进入死信队列。其实这也算最大努力。

所以最大努力通知其实只是表明了一种柔性事务的思想：我已经尽力我最大的努力想达成事务的最终一致了。

适用于对时间不敏感的业务，例如短信通知。


如何保证代码重构后的质量？
首先要明确重构的目的
1、具有完善的单元测试用例、回归测试用例功能全覆盖
2、灰度发布，当出现问题时能够及时回滚
3、充分保证自测
4、保证新旧系统增量数据的同步双写
5、如何进行流量的切换，逐步迁移
6、保证性能
在重构代码上线后，还需要长时间观察稳定性，如数据库连接，网络连接等是否报错率会增加，以及是否有优化空间。总之，代码重构测试不仅仅考虑的是基本功能的测试，还需要关注性能以及缓存，
环境双跑等一系列的测试内容，这是我们这次的一些踩坑经验分享。


### 如何设计一个高并发的系统
1、垂直方向：提升单机能力

提升单机处理能力又可分为硬件和软件两个方面：

硬件方向，升级服务器硬件，购买多核高频机器，大内存，大容量磁盘等。

软件方向，包括用更快的数据结构（编程语言级别的并发编程），改进架构，应用多线程、协程（select/poll/epoll等IO多路复用技术），以及上性能优化各种手段，但是这种方式很容易出现瓶颈。

2、水平方向：分布式集群
  
  为了解决分布式系统的复杂性问题，一般会用到架构分层和服务拆分，通过分层做隔离，通过微服务解耦。
  
  这个理论上没有上限，只要做好层次和服务划分，加机器扩容就能满足需求，但实际上并非如此，一方面分布式会增加系统复杂性，另一方面集群规模上去之后，也会引入一堆服务发现、服务治理的新问题。
  
  因为垂直向的限制，所以，我们通常更关注水平扩展，高并发系统的实施也主要围绕水平方向展开。
  
 3、04 集群化
   单机的硬件扩展成本较高，软件优化易出现性能瓶颈，因此利用集群解决高并发问题。负载均衡是常用的解决方案，即把前端流量分配到不同的服务节点上。
   
   在集群化的架构下，可以采用池化（内存池，连接池，线程池），分布式缓存，分布式消息队列，流控技术（服务降级，应用拆分，限流）和数据库高并发（分库分表，读写分离等）提高并发能力。
   增加分布式缓存，消息队列实现异步
 4、服务限流、熔断、降级机制，保证核心服务的可用性
 
 5、为了方便排查问题，可以加入链路追踪日志系统，加入监控系统以及告警服务
 
 6、持久层可以选用不同的数据库，使用分库分表减轻数据库的压力。也要考虑mysql的高可用
 
 7、应用拆分
 
 8、使用自动构建化系统部署，比如k8s